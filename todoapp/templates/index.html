{% extends "layout.html" %}

{% block title %}
    Index
{% endblock %}

{% block main %}
    <div class="container">
        <form method="POST" action="/add_task" class="row gx-3 gy-2 align-items-center mx-auto text-center"  style="background-color: #f2f2f2; padding: 20px; border-radius: 10px;">
            <!-- Input Category -->
            <div class="col-sm-2">
                <label class="visually-hidden" for="category">Category</label>
                <input type="text" class="form-control" id="category" name="category" placeholder="Category" required>
            </div>

            <!-- Input Task -->
            <div class="col-auto">
                <label class="visually-hidden" for="task">Task</label>
                <input type="text" class="form-control" id="task" name="task" placeholder="Enter a new task" required>
            </div>

            <!-- Input Timeframe -->
            <div class="col-auto">
                <label class="visually-hidden" for="timeframe">Select Timeframe</label>
                <select class="form-select" id="timeframe" name="timeframe" required>
                    <option selected disabled>Select Timeframe</option>
                    <option value="Mon - Fri (morning)">Mon - Fri (morning)</option>
                    <option value="Mon - Fri (noon)">Mon - Fri (noon)</option>
                    <option value="Mon - Fri (evening)">Mon - Fri (evening)</option>
                    <option value="Sat - Sun">Sat - Sun</option>
                </select>
            </div>

            <!-- Input Priority -->
            <div class="col-auto">
                <label class="visually-hidden" for="priority">Select Priority</label>
                <select class="form-select" id="priority" name="priority" required>
                    <option selected disabled>Select Priority</option>
                    <option value="High">High</option>
                    <option value="Medium">Medium</option>
                    <option value="Low">Low</option>
                </select>
            </div>

            <!-- Submit -->
            <div class="col-auto">
            <button type="submit" class="btn btn-primary">Submit</button>
            </div>
        </form>
    </div>


    <table class="table">
        <thead>
            <tr>
                <th> Goal Category</th>
                <th> Task </th>
                <th> Timeframe </th>
                <th> Priority </th>
                <th> Completion </th>
            </tr>
        </thead>
        <tbody>

            <!-- Display existing tasks in the table -->
            {% for task in tasks %}
                <tr>
                    <td>{{ task.category }}</td>
                    <td>{{ task.task }}</td>
                    <td>{{ task.timeframe }}</td>
                    <td>{{ task.priority }}</td>
                    <td>
                        <form method="POST" action="/task_is_done" class="task-form">
                            <div class="col-auto d-flex justify-content-center align-items-center form-check" >
                                <!-- Hidden input to store task_id -->
                                <input type="hidden" name="task_id" value="{{ task.id }}">

                                <!-- Checkbox with value YES when checked -->
                                <input class="form-check-input" type="checkbox" id="completion_{{ task.id }}" name="task_completion" {% if task.completion == "yes" %}checked{% endif %}>

                            </div>
                        </form>

                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <script>
        // Add event listener to each completion checkbox
        document.querySelectorAll('.completion-checkbox').forEach(function(checkbox) {
            checkbox.addEventListener('change', function() {
                // Find the closest form and submit it
                this.closest('.task-form').submit();
            });
        });
    </script>
    
    <img src="/static/planning2.png" class="wide-image">
{% endblock %}


