{% extends "layout.html" %}

{% block title %}
    Index
{% endblock %}

{% block main %}
    <div class="container">
        <form method="POST" action="/add_task" class="row gx-3 gy-2 align-items-center mx-auto text-center"  style="background-color: #f2f2f2; padding: 20px; border-radius: 10px;">
            <!-- Input Category -->
            <div class="col-sm-2">
                <label class="visually-hidden" for="category">Category</label>
                <input type="text" class="form-control" id="category" name="category" placeholder="Category" autocomplete="off" required>
            </div>

            <!-- Input Task -->
            <div class="col-auto">
                <label class="visually-hidden" for="task">Task</label>
                <input type="text" class="form-control" id="task" name="task" placeholder="Enter a new task" autocomplete="off" required>
            </div>

            <!-- Input Timeframe -->
            <div class="col-auto">
                <label class="visually-hidden" for="timeframe">Select Timeframe</label>
                <select class="form-select" id="timeframe" name="timeframe" required>
                    <option selected disabled>Select Timeframe</option>
                    <option value="Mon - Fri (morning)">Mon - Fri (morning)</option>
                    <option value="Mon - Fri (noon)">Mon - Fri (noon)</option>
                    <option value="Mon - Fri (evening)">Mon - Fri (evening)</option>
                    <option value="Sat - Sun">Sat - Sun</option>
                </select>
            </div>

            <!-- Input Priority -->
            <div class="col-auto">
                <label class="visually-hidden" for="priority">Select Priority</label>
                <select class="form-select" id="priority" name="priority" required>
                    <option selected disabled>Select Priority</option>
                    <option value="High">High</option>
                    <option value="Medium">Medium</option>
                    <option value="Low">Low</option>
                </select>
            </div>

            <!-- Submit -->
            <div class="col-auto">
            <button type="submit" class="btn btn-primary">Submit</button>
            </div>
        </form>
    </div>


    <table class="table">
        <thead>
            <tr>
                <th> Goal Category</th>
                <th> Task </th>
                <th> Timeframe </th>
                <th> Priority </th>
                <th> Remove Task </th>
            </tr>
        </thead>
        <tbody>

            <!-- Display existing tasks in the table -->
            {% for task in tasks %}
                <tr>
                    <td class="align-middle">
                        <div class="d-flex align-items-center " >
                            <form method="POST" action="/updateTaskStatus/{{ task.id }}" class="task-form completion-checkbox">
                                <div class=" col-auto d-flex justify-content-center align-items-center form-check" >
                                    <!-- Hidden input to store task_id -->
                                    <input type="hidden" name="task_id" value="{{ task.id }}">

                                    <!-- Checkbox with value 1 when checked -->
                                    <input class="form-check-input completion-checkbox"
                                           type="checkbox"
                                           id="completion_{{ task.id }}"
                                           name="task_completion"
                                           data-task-id="{{ task.id }}"
                                           data-completion="{{ task.completion}}"
                                           {% if task.completion == 1 %}checked{% endif %}
                                           onchange="updateTaskStatus(this)">

                                </div>
                            </form>
                            <label class="form-check-label ms-5" for="completion_{{ task.id }}">
                                {{ task.category }}
                            </label>
                        </div>
                    </td>


                    <td>{{ task.task }}</td>
                    <td>{{ task.timeframe }}</td>
                    <td>{{ task.priority }}</td>
                    <td>
                        <!-- Button to open the delete confirmation modal -->
                        <button class="btn-close" data-bs-toggle="modal" data-bs-target="#deleteConfirmationModal_{{ task.id }}"></button>

                        <!-- Delete confirmation modal -->
                        <div class="modal fade" id="deleteConfirmationModal_{{ task.id }}" tabindex="-1" aria-labelledby="deleteConfirmationModalLabel_{{ task.id }}" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="deleteConfirmationModalLabel_{{ task.id }}">Confirm Deletion</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        Are you sure you want to delete this task?
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                        <!-- Button to submit the delete form -->
                                        <button type="button" class="btn btn-primary">Delete</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Form to submit the delete action -->
                        <!-- <form method="POST" action="/delete_task" class="delete-task-form" id="deleteForm_{{ task.id }}">
                            <input type="hidden" name="task_id" value="{{ task.id }}">
                        </form> -->
                    </td>

                </tr>
            {% endfor %}
        </tbody>
    </table>

    <script>
        function updateTaskStatus(checkbox) {
            const taskId = checkbox.getAttribute("data-task-id");
            const newCompletionValue = checkbox.checked ? 1 : 0;

            // Отправляем асинхронный запрос на сервер
            fetch(`/update_task_status/${taskId}/${newCompletionValue}`, {
                method: 'POST',
            })
            .then(response => response.json())
            .then(data => {
                console.log(data);
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }
    </script>

    <sctipt>
        function delete_task() {
            
            // Отправляем асинхронный запрос на сервер
            fetch(`/update_task_status/${taskId}/${newCompletionValue}`, {
                method: 'POST',
            })
            .then(response => response.json())
            .then(data => {
                console.log(data);
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }
    </sctipt>


    <img src="/static/planning2.png" class="wide-image">
{% endblock %}


